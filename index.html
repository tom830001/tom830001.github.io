<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Wialon Playground - Login</title>
    <script type="text/javascript" src="//code.jquery.com/jquery-latest.min.js"></script>
</head>
<meta name=”viewport” content=”width=device-width, initial-scale=1.0″>
<script>
	var tmp = (+new Date());

	function timeStamp2String (time){
	        var datetime = new Date();
	         datetime.setTime(time);
	         var year = datetime.getFullYear();
	         var month = datetime.getMonth() + 1;
	         var date = datetime.getDate();
	         var hour = datetime.getHours();
	         var minute = datetime.getMinutes();
	         var second = datetime.getSeconds();
	         var mseconds = datetime.getMilliseconds();
	         return year + "-" + month + "-" + date;
	};
	
	function all() {
		Showname();
		Showtime();
	}
	
	function Showname() {
		$.getJSON("https://cors-anywhere.herokuapp.com/https://sleague.tw/jsons/games/1/17/65/66/2583/game.json?nocache="+tmp, function(json) {
			$('#jsonTable1').css("visibility", "visible").css("border", "1px solid green").css("font-size", "24");
			$('#jsonTable1').append("<tbody>");
			$('#jsonTable1').append("<tr><td>" + timeStamp2String(json.playDate)+" "+json.playTime + "</td></tr>");
			$('#jsonTable1').append("<tr><td>" + json.teamGuestRecord.team.name +"</td><td>" + " " + "</td><td>" + json.teamHomeRecord.team.name +  "</td></tr>");
			$('#jsonTable1').append("</tbody>");
			$('th').css("border", "1px solid green");
			console.log(json.teamGuest.name);
		});
		
	}
	// Logout
	function Showtime() {
		var d = new Date()
		console.log(d);
		$("#date").val(d);
		
		$.getJSON("https://cors-anywhere.herokuapp.com/https://sleague.tw/jsons/games/1/17/65/66/2583/game.json?nocache="+tmp, function(json) {
			$("#team1").val(json.teamGuestRecord.score);
			$("#team2").val(json.teamHomeRecord.score);
		});
		
		setTimeout('Showtime()',1000);
	}

	// Get current user and prints its name to log

	// execute when DOM ready
	$(document).ready(function(){
	var data = JSON.stringify({
	  "method": "Authenticate",
	  "params": {
		"database": "amit_1",
		"userName": "tom_li@amit.com.tw",
		"password": "ANan5459@amit.com.tw"
	  }
	});
	var xhr = new XMLHttpRequest();
	var return_value;
	xhr.addEventListener("readystatechange", function () {
	  if (this.readyState === 4) {
		/*console.log(this.responseText);*/
		return_value = JSON.parse(this.responseText);
		$("#token").val(return_value.result.credentials.sessionId);
		$("#GetFeed").val("https://my1032.geotab.com/apiv1/GetFeed?credentials={%22database%22:%22amit_1%22,%22sessionId%22:%22"+return_value.result.credentials.sessionId+"%22,%22userName%22:%22tom_li@amit.com.tw%22}&typeName=LogRecord&resultsLimit=10&search={%22deviceSearch%22:{%22id%22:%22b4%22}}");
		$("#Authenticate").val("https://my1032.geotab.com/apiv1/Authenticate?password=ANan5459@amit.com.tw&userName=tom_li@amit.com.tw&database=AMIT_1");
		$("#Add").val("https://my1032.geotab.com/apiv1/Add?typeName=Device&entity={%22serialNumber%22:%22GT970000006A%22,%22Name%22:%22My%20First%20car%22}&credentials={%22database%22:%22amit_1%22,%22username%22:%22tom_li@amit.com.tw%22,%22password%22:%22ANan5459@amit.com.tw%22}");
		
		}
	});

	xhr.open("POST", "https://my1032.geotab.com/apiv1");
	xhr.setRequestHeader("content-type", "application/json");
	xhr.setRequestHeader("cache-control", "no-cache");

	xhr.send(data);
		// For more info about how to generate token check
		// http://sdk.wialon.com/playground/demo/app_auth_token
		/*$("#token").val("5dce19710a5e26ab8b7b8986cb3c49e58C291791B7F0A7AEB8AFBFCEED7DC03BC48FF5F8");*/
		// bind actions to buttons click
		//$("#login_btn").click( login );
	}
	);
	
/*
<input type="button" value="login" id="login_btn" />
<input type="button" value="logout" id="logout_btn" />
<input type="button" value="get user" id="user_btn" />
<div id="log"></div>
*/	
/*https://my1032.geotab.com/apiv1/Set?credentials={%22database%22:%22amit_1%22,%22sessionId%22:%22WmuihjJ4sNqddG0L5zBVEw%22,%22userName%22:%22tom_li@amit.com.tw%22}&typeName=Device&entity={%22id%22:%22b04%22,%22serialNumber%22:%22GT970000006A%22,%22Name%22:%22My1%20First%20car%22}*/
	</script>
<body onload="all()">
date: <input id="date" input style="width:350px"/><p>

<table id="jsonTable1"width="25%"><p>
<a><img src="台灣啤酒.png" width="50" height="50"></a>
team1: <input id="team1" input style="width:50px"/>
team2: <input id="team2" input style="width:50px"/>
<a><img src="裕隆納智捷.png" width="50" height="50"></a>
<p>


</body>
</html>

